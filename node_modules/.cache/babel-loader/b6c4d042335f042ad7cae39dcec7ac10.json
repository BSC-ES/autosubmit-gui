{"ast":null,"code":"import _regeneratorRuntime from\"/Users/BleuDChan/ReposBSC/autosubmitreact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/BleuDChan/ReposBSC/autosubmitreact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/BleuDChan/ReposBSC/autosubmitreact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from\"react\";import axios from\"axios\";import StatsContext from\"./statsContext\";import StatsReducer from\"./statsReducer\";import{SET_LOADING,GET_EXPERIMENT_STATS,CLEAR_STATS,SET_ERROR_STATS}from\"../types\";import{sleep}from\"../utils\";import{AUTOSUBMIT_API_SOURCE,DEBUG,NOAPI}from\"../vars\";var StatsState=function StatsState(props){var initialState={loading:false,statdata:null,ticksdata:null,isError:false,totaldata:null,errorMessage:\"\"};var localserver=AUTOSUBMIT_API_SOURCE;//const localserver = \"https://earth.bsc.es/autosubmitapi/\";\n//const localserver = \"http://84.88.185.94:8081\";\nvar debug=DEBUG;var _useReducer=useReducer(StatsReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// Get Experiment Stats\nvar getExperimentStats=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(expid,hours,type){var res,result,requestResult,ticks,i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:debug&&console.log(\"Getting...\");if(hours.length===0){hours=0;}if(type.length===0){type=\"Any\";}setLoading();//cleanGraphData();\nres=null;if(!NOAPI){_context.next=11;break;}res={data:null};res.data=require(\"../data/stats_\"+String(expid)+\".json\");sleep(1000);_context.next=14;break;case 11:_context.next=13;return axios.get(\"\".concat(localserver,\"/stats/\").concat(expid,\"/\").concat(hours,\"/\").concat(type));case 13:res=_context.sent;case 14:result=[];requestResult=null;ticks=[];debug&&console.log(res.data);if(res.data){if(res.data.error===true){setIsError(true,res.data.error_message);}else{setIsError(false,\"\");}result.push([\"Jobs\",\"Queued\",\"Run\",\"Failed Jobs\",\"Failed Queued\",\"Fail Run\"]);for(i=0;i<res.data.jobs.length;i++){result.push([{v:i+1,f:res.data.jobs[i]},res.data.stats.queued[i],res.data.stats.run[i],res.data.stats.failed_jobs[i],res.data.stats.fail_queued[i],res.data.stats.fail_run[i]]);ticks.push({v:i+1,f:res.data.jobs[i]});}requestResult=res.data;}//console.log(ticks);\n// console.log(result);\n// console.log(requestResult);\n// console.log(ticks);\ndispatch({type:GET_EXPERIMENT_STATS,payload:{result:result,requestResult:requestResult,ticks:ticks}});case 20:case\"end\":return _context.stop();}}},_callee);}));return function getExperimentStats(_x,_x2,_x3){return _ref.apply(this,arguments);};}();// Clear stats data\nvar clearStats=function clearStats(){return dispatch({type:CLEAR_STATS});};var setLoading=function setLoading(){return dispatch({type:SET_LOADING});};var setIsError=function setIsError(error,msg){dispatch({type:SET_ERROR_STATS,payload:{error:error,msg:msg}});};return/*#__PURE__*/React.createElement(StatsContext.Provider,{value:{loading:state.loading,statdata:state.statdata,isError:state.isError,errorMessage:state.errorMessage,totaldata:state.totaldata,ticksdata:state.ticksdata,getExperimentStats:getExperimentStats,clearStats:clearStats}},props.children);};export default StatsState;","map":{"version":3,"sources":["/Users/BleuDChan/ReposBSC/autosubmitreact/src/components/context/statistics/StatsState.js"],"names":["React","useReducer","axios","StatsContext","StatsReducer","SET_LOADING","GET_EXPERIMENT_STATS","CLEAR_STATS","SET_ERROR_STATS","sleep","AUTOSUBMIT_API_SOURCE","DEBUG","NOAPI","StatsState","props","initialState","loading","statdata","ticksdata","isError","totaldata","errorMessage","localserver","debug","state","dispatch","getExperimentStats","expid","hours","type","console","log","length","setLoading","res","data","require","String","get","result","requestResult","ticks","error","setIsError","error_message","push","i","jobs","v","f","stats","queued","run","failed_jobs","fail_queued","fail_run","payload","clearStats","msg","children"],"mappings":"6dAAA,MAAOA,CAAAA,KAAP,EAAgBC,UAAhB,KAAkC,OAAlC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,OACEC,WADF,CAEEC,oBAFF,CAGEC,WAHF,CAIEC,eAJF,KAKO,UALP,CAMA,OAASC,KAAT,KAAsB,UAAtB,CAEA,OAASC,qBAAT,CAAgCC,KAAhC,CAAuCC,KAAvC,KAAoD,SAApD,CAEA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACC,KAAD,CAAW,CAC5B,GAAMC,CAAAA,YAAY,CAAG,CACnBC,OAAO,CAAE,KADU,CAEnBC,QAAQ,CAAE,IAFS,CAGnBC,SAAS,CAAE,IAHQ,CAInBC,OAAO,CAAE,KAJU,CAKnBC,SAAS,CAAE,IALQ,CAMnBC,YAAY,CAAE,EANK,CAArB,CASA,GAAMC,CAAAA,WAAW,CAAGZ,qBAApB,CACA;AACA;AACA,GAAMa,CAAAA,KAAK,CAAGZ,KAAd,CAb4B,gBAcFV,UAAU,CAACG,YAAD,CAAeW,YAAf,CAdR,4CAcrBS,KAdqB,iBAcdC,QAdc,iBAgB5B;AACA,GAAMC,CAAAA,kBAAkB,0FAAG,iBAAOC,KAAP,CAAcC,KAAd,CAAqBC,IAArB,uJACzBN,KAAK,EAAIO,OAAO,CAACC,GAAR,CAAY,YAAZ,CAAT,CACA,GAAIH,KAAK,CAACI,MAAN,GAAiB,CAArB,CAAwB,CACtBJ,KAAK,CAAG,CAAR,CACD,CACD,GAAIC,IAAI,CAACG,MAAL,GAAgB,CAApB,CAAuB,CACrBH,IAAI,CAAG,KAAP,CACD,CAEDI,UAAU,GACV;AACIC,GAXqB,CAWf,IAXe,KAYrBtB,KAZqB,0BAavBsB,GAAG,CAAG,CAACC,IAAI,CAAC,IAAN,CAAN,CACAD,GAAG,CAACC,IAAJ,CAAWC,OAAO,CAAC,iBAAiBC,MAAM,CAACV,KAAD,CAAvB,CAA+B,OAAhC,CAAlB,CACAlB,KAAK,CAAC,IAAD,CAAL,CAfuB,sDAiBXP,CAAAA,KAAK,CAACoC,GAAN,WACPhB,WADO,mBACcK,KADd,aACuBC,KADvB,aACgCC,IADhC,EAjBW,SAiBvBK,GAjBuB,uBAsBrBK,MAtBqB,CAsBZ,EAtBY,CAuBrBC,aAvBqB,CAuBL,IAvBK,CAwBrBC,KAxBqB,CAwBb,EAxBa,CAyBzBlB,KAAK,EAAIO,OAAO,CAACC,GAAR,CAAYG,GAAG,CAACC,IAAhB,CAAT,CACA,GAAID,GAAG,CAACC,IAAR,CAAc,CACZ,GAAID,GAAG,CAACC,IAAJ,CAASO,KAAT,GAAmB,IAAvB,CAA6B,CAC3BC,UAAU,CAAC,IAAD,CAAOT,GAAG,CAACC,IAAJ,CAASS,aAAhB,CAAV,CACD,CAFD,IAEO,CACLD,UAAU,CAAC,KAAD,CAAQ,EAAR,CAAV,CACD,CAEDJ,MAAM,CAACM,IAAP,CAAY,CACV,MADU,CAEV,QAFU,CAGV,KAHU,CAIV,aAJU,CAKV,eALU,CAMV,UANU,CAAZ,EASA,IAASC,CAAT,CAAa,CAAb,CAAgBA,CAAC,CAAGZ,GAAG,CAACC,IAAJ,CAASY,IAAT,CAAcf,MAAlC,CAA0Cc,CAAC,EAA3C,CAA+C,CAC7CP,MAAM,CAACM,IAAP,CAAY,CACV,CAAEG,CAAC,CAAEF,CAAC,CAAG,CAAT,CAAYG,CAAC,CAAEf,GAAG,CAACC,IAAJ,CAASY,IAAT,CAAcD,CAAd,CAAf,CADU,CAEVZ,GAAG,CAACC,IAAJ,CAASe,KAAT,CAAeC,MAAf,CAAsBL,CAAtB,CAFU,CAGVZ,GAAG,CAACC,IAAJ,CAASe,KAAT,CAAeE,GAAf,CAAmBN,CAAnB,CAHU,CAIVZ,GAAG,CAACC,IAAJ,CAASe,KAAT,CAAeG,WAAf,CAA2BP,CAA3B,CAJU,CAKVZ,GAAG,CAACC,IAAJ,CAASe,KAAT,CAAeI,WAAf,CAA2BR,CAA3B,CALU,CAMVZ,GAAG,CAACC,IAAJ,CAASe,KAAT,CAAeK,QAAf,CAAwBT,CAAxB,CANU,CAAZ,EAQAL,KAAK,CAACI,IAAN,CAAW,CAAEG,CAAC,CAAEF,CAAC,CAAG,CAAT,CAAYG,CAAC,CAAEf,GAAG,CAACC,IAAJ,CAASY,IAAT,CAAcD,CAAd,CAAf,CAAX,EACD,CACDN,aAAa,CAAGN,GAAG,CAACC,IAApB,CACD,CACD;AACA;AACA;AACA;AACAV,QAAQ,CAAC,CACPI,IAAI,CAAEvB,oBADC,CAEPkD,OAAO,CAAE,CAAEjB,MAAM,CAANA,MAAF,CAAUC,aAAa,CAAbA,aAAV,CAAyBC,KAAK,CAALA,KAAzB,CAFF,CAAD,CAAR,CA3DyB,uDAAH,kBAAlBf,CAAAA,kBAAkB,oDAAxB,CAiEA;AACA,GAAM+B,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,SAAMhC,CAAAA,QAAQ,CAAC,CAAEI,IAAI,CAAEtB,WAAR,CAAD,CAAd,EAAnB,CAEA,GAAM0B,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,SAAMR,CAAAA,QAAQ,CAAC,CAAEI,IAAI,CAAExB,WAAR,CAAD,CAAd,EAAnB,CAEA,GAAMsC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACD,KAAD,CAAQgB,GAAR,CAAgB,CACjCjC,QAAQ,CAAC,CACPI,IAAI,CAAErB,eADC,CAEPgD,OAAO,CAAE,CAAEd,KAAK,CAALA,KAAF,CAASgB,GAAG,CAAHA,GAAT,CAFF,CAAD,CAAR,CAID,CALD,CAOA,mBACE,oBAAC,YAAD,CAAc,QAAd,EACE,KAAK,CAAE,CACL1C,OAAO,CAAEQ,KAAK,CAACR,OADV,CAELC,QAAQ,CAAEO,KAAK,CAACP,QAFX,CAGLE,OAAO,CAAEK,KAAK,CAACL,OAHV,CAILE,YAAY,CAAEG,KAAK,CAACH,YAJf,CAKLD,SAAS,CAAEI,KAAK,CAACJ,SALZ,CAMLF,SAAS,CAAEM,KAAK,CAACN,SANZ,CAOLQ,kBAAkB,CAAlBA,kBAPK,CAQL+B,UAAU,CAAVA,UARK,CADT,EAYG3C,KAAK,CAAC6C,QAZT,CADF,CAgBD,CA9GD,CAgHA,cAAe9C,CAAAA,UAAf","sourcesContent":["import React, { useReducer } from \"react\";\nimport axios from \"axios\";\nimport StatsContext from \"./statsContext\";\nimport StatsReducer from \"./statsReducer\";\nimport {\n  SET_LOADING,\n  GET_EXPERIMENT_STATS,\n  CLEAR_STATS,\n  SET_ERROR_STATS,\n} from \"../types\";\nimport { sleep } from \"../utils\";\n\nimport { AUTOSUBMIT_API_SOURCE, DEBUG, NOAPI } from \"../vars\";\n\nconst StatsState = (props) => {\n  const initialState = {\n    loading: false,\n    statdata: null,\n    ticksdata: null,\n    isError: false,\n    totaldata: null,\n    errorMessage: \"\",\n  };\n\n  const localserver = AUTOSUBMIT_API_SOURCE;\n  //const localserver = \"https://earth.bsc.es/autosubmitapi/\";\n  //const localserver = \"http://84.88.185.94:8081\";\n  const debug = DEBUG;\n  const [state, dispatch] = useReducer(StatsReducer, initialState);\n\n  // Get Experiment Stats\n  const getExperimentStats = async (expid, hours, type) => {\n    debug && console.log(\"Getting...\");\n    if (hours.length === 0) {\n      hours = 0;\n    }\n    if (type.length === 0) {\n      type = \"Any\";\n    }\n\n    setLoading();\n    //cleanGraphData();\n    let res = null;\n    if (NOAPI) {\n      res = {data:null};\n      res.data = require(\"../data/stats_\"+String(expid)+\".json\")\n      sleep(1000);\n    } else {\n      res = await axios.get(\n        `${localserver}/stats/${expid}/${hours}/${type}`\n      );\n    }\n    \n    let result = [];\n    var requestResult = null;\n    let ticks = [];\n    debug && console.log(res.data);\n    if (res.data) {\n      if (res.data.error === true) {\n        setIsError(true, res.data.error_message);\n      } else {\n        setIsError(false, \"\");\n      }\n\n      result.push([\n        \"Jobs\",\n        \"Queued\",\n        \"Run\",\n        \"Failed Jobs\",\n        \"Failed Queued\",\n        \"Fail Run\",\n      ]);\n\n      for (var i = 0; i < res.data.jobs.length; i++) {\n        result.push([\n          { v: i + 1, f: res.data.jobs[i] },\n          res.data.stats.queued[i],\n          res.data.stats.run[i],\n          res.data.stats.failed_jobs[i],\n          res.data.stats.fail_queued[i],\n          res.data.stats.fail_run[i],\n        ]);\n        ticks.push({ v: i + 1, f: res.data.jobs[i] });\n      }\n      requestResult = res.data;\n    }\n    //console.log(ticks);\n    // console.log(result);\n    // console.log(requestResult);\n    // console.log(ticks);\n    dispatch({\n      type: GET_EXPERIMENT_STATS,\n      payload: { result, requestResult, ticks },\n    });\n  };\n\n  // Clear stats data\n  const clearStats = () => dispatch({ type: CLEAR_STATS });\n\n  const setLoading = () => dispatch({ type: SET_LOADING });\n\n  const setIsError = (error, msg) => {\n    dispatch({\n      type: SET_ERROR_STATS,\n      payload: { error, msg },\n    });\n  };\n\n  return (\n    <StatsContext.Provider\n      value={{\n        loading: state.loading,\n        statdata: state.statdata,\n        isError: state.isError,\n        errorMessage: state.errorMessage,\n        totaldata: state.totaldata,\n        ticksdata: state.ticksdata,\n        getExperimentStats,\n        clearStats,\n      }}\n    >\n      {props.children}\n    </StatsContext.Provider>\n  );\n};\n\nexport default StatsState;\n"]},"metadata":{},"sourceType":"module"}